{% extends "base2.html" %}
{% load static %}
{% block titulo %} Centro de recursos - {{ semillero.sigla }} {% endblock %}
{% block css %}
<link href="{% static 'css/recursos.css' %}" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}
{% block contenido %} {% endblock %}
{% block main %}
    <!-- Mensajes de alerta -->
    {% if messages %}
    <script>
        {% for message in messages %}
            mostrarMensajeExito("{{ message|escapejs }}", "{{ message.tags }}");
        {% endfor %}
    </script>
    {% endif %}

    <div class="resumen">
        {% if semillero.estado != 'desactivado' %}
            <div class="cont-1">
                {% if perms.GC2.add_documento %}
                    <div class="boton-agregar">
                        <button class="btn btn-anadir" data-bs-toggle="modal" data-bs-target="#modal-crear">
                            <img src="{% static 'img/+.png' %}" alt="Icono de Añadir Recurso"> Añadir Recurso
                        </button>
                    </div>
                {% endif %}
            </div>
        {% endif %}
        <div class="cont-2">
            <div class="grupo">
                <div class="card">
                    <div class="icon-cont documentos">
                        <img class="icon" src="{% static 'img/Books.png' %}" alt="Icono Documentos y Guías">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Documentos y Guías</h5>
                        <p>Material de referencia y guías para apoyar la gestión de semilleros y proyectos.</p>           
                    </div>
                </div>
                <div class="scrollable-list">
                    {% for documento in documentos %}
                    <ul class="lista">
                        <li>
                            <div class="icon-cont">
                                <img src="{% static 'img/Documents1.png' %}" alt="Icono" class="icono">
                            </div>
                            <div class="texto-lista">
                                <span class="titulo">{{ documento.nom_doc }}</span><br>
                                <span class="subtitulo">{{ documento.tipo }}</span>
                            </div>
                            {% if documento.archivo %}
                            <div  class="recurso-item">
                                <a href="{{ documento.archivo.url }}" 
                                    class="fa fa-download descargar" 
                                    aria-hidden="true" 
                                    target="_blank">
                                </a>
                                <!-- Botón eliminar con modal -->
                                {% if perms.GC2.delete_documento %}
                                    {% if semillero.estado != 'desactivado' %}
                                        <a  class="fa fa-trash-alt eliminar-recurso"
                                            data-nombre="{{ documento.nom_doc }}"
                                            data-url="{% url 'eliminar_recurso' semillero.id_sem documento.cod_doc %}"
                                            title="Eliminar {{ documento.nom_doc }}">
                                        </a>
                                    {% endif %}
                                {% endif %}
                            </div>
                            {% endif %}
                        </li>
                    </ul>
                    {% empty %}
                    <div class="empty-message">
                        <i class="fa fa-folder-open"></i>
                        <p>No hay fichas disponibles en este momento</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="grupo">
                <div class="card">
                    <div class="icon-cont fichas">
                        <img class="icon" src="{% static 'img/forms.png' %}" alt="Icono Documentos y Guías">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Fichas y Actas</h5>
                        <p>Material de registro disponibles para consulta y documentación institucional.</p>           
                    </div>
                </div>
                <div class="scrollable-list">
                    {% for ficha in fichas %}
                    <ul class="lista">
                        <li>
                            <div class="icon-cont">
                                <img src="{% static 'img/Documents1.png' %}" alt="Icono" class="icono">
                            </div>
                            <div class="texto-lista">
                                <span class="titulo">{{ ficha.nom_doc }}</span><br>
                                <span class="subtitulo">{{ ficha.tipo }}</span>
                            </div>
                            {% if ficha.archivo %}
                            <div  class="recurso-item">
                                <a href="{{ ficha.archivo.url }}" 
                                    class="fa fa-download descargar" 
                                    aria-hidden="true" 
                                    target="_blank">
                                </a>
                                <!-- Botón eliminar con modal -->
                                {% if perms.GC2.delete_documento %}
                                    {% if semillero.estado != 'desactivado' %}
                                        <a class="fa fa-trash-alt eliminar-recurso"
                                            data-nombre="{{ ficha.nom_doc }}"
                                            data-url="{% url 'eliminar_recurso' semillero.id_sem ficha.cod_doc %}"
                                            title="Eliminar {{ ficha.nom_doc }}">
                                        </a>
                                    {% endif %}
                                {% endif %}
                            </div>
                            {% endif %}
                        </li>
                    </ul>
                    {% empty %}
                    <div class="empty-message">
                        <i class="fa fa-folder-open"></i>
                        <p>No hay fichas disponibles en este momento</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL CONFIRMAR ELIMINACIÓN DE RECURSO -->
<div id="modal-eliminar-recurso" class="modal-overlay">
    <div class="modal-contenedor">
        <h3>¿Confirmar eliminación?</h3>
        <p id="texto-modal-recurso">¿Deseas eliminar este recurso?</p>
        <div class="modal-botones">
            <button id="cancelar-recurso" type="button" class="btn-cancelar">Cancelar</button>
            <form id="form-eliminar-recurso" method="POST">
                {% csrf_token %}
                <button type="submit" class="btn-confirmar">Eliminar</button>
            </form>
        </div>
    </div>
</div>


<!-- Modal Crear Recurso -->
<div id="modal-crear" class="modal-overlay">
    <div class="modal-contenedor">
        <!-- Botón cerrar -->
        <a href="{% url 'recursos' semillero.id_sem %}" 
           class="modal-cerrar" 
           onclick="cerrarModal('modal-semillero'); return false;">&times;</a>

        <!-- Encabezado -->
        <div class="modal-header">
            <img src="{% static 'img/folder.png' %}" alt="Icono de semilleros">
            <h2 class="modal-titulo">Añadir Recurso</h2>
        </div>

        <!-- Formulario -->
        <form method="POST" action="{% url 'agregar_recurso' semillero.id_sem %}" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="modal-body">
                <div class="mb-3">
                    <label for="nom_doc" class="form-label">Título</label>
                    <input type="text" class="form-control" id="nom_doc" name="nom_doc" required>
                </div>
                <div class="mb-3">
                    <label for="id_tipo" class="form-label">Tipo de Archivo</label>
                    <select class="form-select" id="id_tipo" name="tipo" required>
                        <option value="">Seleccione una categoria</option>
                        <option value="Documento">Documento</option>
                        <option value="Guía">Guía</option>
                        <option value="Ficha">Ficha</option>
                        <option value="Acta">Acta</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="archivo" class="form-label">Archivo (PDF)</label>
                    <input type="file" class="form-control" id="archivo" name="archivo" accept=".pdf" required>
                </div>
            </div>

            <div class="modal-acciones">
                <a href="{% url 'recursos' semillero.id_sem %}" class="modal-btn modal-btn-cancelar">
                    <i class="fas fa-times"></i> Cancelar
                </a>
                <button type="submit" class="modal-btn modal-btn-primario">
                    <i class="fas fa-check"></i> Agregar Recurso
                </button>
            </div>
        </form>
    </div>
</div>
    <script src="{% static 'js/notificaciones.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/modalrecursos.js' %}"></script>
    <script src="{% static 'js/mensaje.js' %}"></script>

{% endblock %}