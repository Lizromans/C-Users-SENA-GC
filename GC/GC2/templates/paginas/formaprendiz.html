{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Formulario de registro para aprendices SENA">
    <title>Registro de Aprendiz SENA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'css/formaprendiz.css' %}">
</head>
<body>
    <!-- Partículas de fondo -->
    <div class="bg-particles" aria-hidden="true">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Indicador de guardado automático -->
    <div class="autosave-indicator" id="autosaveIndicator" role="status" aria-live="polite">
        <span class="spinner"></span>
        <span class="message">Guardando...</span>
    </div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="form-container">
                    <div class="sena-header">
                        <h1 class="text-center mb-0 h2">Registro de Aprendiz SENA</h1>
                    </div>
                    
                    <!-- Barra de progreso -->
                    <div class="progress-container">
                        <div class="progress">
                            <div class="progress-bar" id="progressBar" role="progressbar" 
                                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" 
                                 style="width: 0%"></div>
                        </div>
                        <div class="progress-label" id="progressLabel">Sección 1 de 4</div>
                    </div>
                    
                    <form method="post" id="aprendizForm" novalidate>
                        {% csrf_token %}
                        
                        <!-- SECCIÓN 1: Información Personal -->
                        <fieldset data-section="1">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-person-fill"></i>
                                </div>
                                <h5 class="section-title">Información Personal</h5>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.tipo_doc.id_for_label }}">
                                        {{ form.tipo_doc.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                        <span class="tooltip-icon" data-bs-toggle="tooltip" 
                                              title="Selecciona el tipo de documento de identidad">?</span>
                                    </label>
                                    {{ form.tipo_doc }}
                                    {% if form.tipo_doc.errors %}
                                        <div class="text-danger" role="alert">{{ form.tipo_doc.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.cedula_apre.id_for_label }}">
                                        {{ form.cedula_apre.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                    </label>
                                    {{ form.cedula_apre }}
                                    <div class="char-counter" data-max="20" data-field="cedula_apre">
                                        <span class="current">0</span>/<span class="max">20</span>
                                    </div>
                                    {% if form.cedula_apre.errors %}
                                        <div class="text-danger" role="alert">{{ form.cedula_apre.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.nombre.id_for_label }}">
                                        {{ form.nombre.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                    </label>
                                    {{ form.nombre }}
                                    {% if form.nombre.errors %}
                                        <div class="text-danger" role="alert">{{ form.nombre.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.apellido.id_for_label }}">
                                        {{ form.apellido.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                    </label>
                                    {{ form.apellido }}
                                    {% if form.apellido.errors %}
                                        <div class="text-danger" role="alert">{{ form.apellido.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.fecha_nacimiento.id_for_label }}">
                                        {{ form.fecha_nacimiento.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                    </label>
                                    {{ form.fecha_nacimiento }}
                                    {% if form.fecha_nacimiento.errors %}
                                        <div class="text-danger" role="alert">{{ form.fecha_nacimiento.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.telefono.id_for_label }}">
                                        {{ form.telefono.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                        <span class="tooltip-icon" data-bs-toggle="tooltip" 
                                              title="Ingresa tu número de teléfono celular">?</span>
                                    </label>
                                    {{ form.telefono }}
                                    <div class="char-counter" data-max="10" data-field="telefono">
                                        <span class="current">0</span>/<span class="max">10</span>
                                    </div>
                                    {% if form.telefono.errors %}
                                        <div class="text-danger" role="alert">{{ form.telefono.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </fieldset>
                        
                        <hr class="my-4">
                        
                        <!-- SECCIÓN 2: Información Académica -->
                        <fieldset data-section="2">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-book-fill"></i>
                                </div>
                                <h5 class="section-title">Información Académica</h5>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.ficha.id_for_label }}">
                                        {{ form.ficha.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                        <span class="tooltip-icon" data-bs-toggle="tooltip" 
                                              title="Número de tu ficha de formación">?</span>
                                    </label>
                                    {{ form.ficha }}
                                    {% if form.ficha.errors %}
                                        <div class="text-danger" role="alert">{{ form.ficha.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.modalidad.id_for_label }}">
                                        {{ form.modalidad.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                    </label>
                                    {{ form.modalidad }}
                                    {% if form.modalidad.errors %}
                                        <div class="text-danger" role="alert">{{ form.modalidad.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label" for="{{ form.programa.id_for_label }}">
                                    {{ form.programa.label }}
                                    <span class="required-asterisk" aria-label="requerido">*</span>
                                </label>
                                {{ form.programa }}
                                {% if form.programa.errors %}
                                    <div class="text-danger" role="alert">{{ form.programa.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.correo_per.id_for_label }}">
                                        {{ form.correo_per.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                        <span class="tooltip-icon" data-bs-toggle="tooltip" 
                                              title="Tu correo electrónico personal">?</span>
                                    </label>
                                    {{ form.correo_per }}
                                    {% if form.correo_per.errors %}
                                        <div class="text-danger" role="alert">{{ form.correo_per.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.correo_ins.id_for_label }}">
                                        {{ form.correo_ins.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                        <span class="tooltip-icon" data-bs-toggle="tooltip" 
                                              title="Tu correo institucional @soy.sena.edu.co">?</span>
                                    </label>
                                    {{ form.correo_ins }}
                                    {% if form.correo_ins.errors %}
                                        <div class="text-danger" role="alert">{{ form.correo_ins.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </fieldset>
                        
                        <hr class="my-4">
                        
                        <!-- SECCIÓN 3: Información Bancaria -->
                        <fieldset data-section="3">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-credit-card-fill"></i>
                                </div>
                                <h5 class="section-title">Información Bancaria</h5>
                            </div>
                            
                            <div class="alert alert-info" role="alert">
                                <strong><i class="bi bi-info-circle-fill"></i> ¿Por qué necesitamos esta información?</strong><br>
                                Los datos bancarios son necesarios únicamente para la consignación de biáticos 
                                cuando seas asignado a un semillero de investigación. Esta información será 
                                tratada de forma confidencial y segura.
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.medio_bancario.id_for_label }}">
                                        {{ form.medio_bancario.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                        <span class="tooltip-icon" data-bs-toggle="tooltip" 
                                              title="Selecciona el banco donde tienes tu cuenta">?</span>
                                    </label>
                                    {{ form.medio_bancario }}
                                    {% if form.medio_bancario.errors %}
                                        <div class="text-danger" role="alert">{{ form.medio_bancario.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label" for="{{ form.numero_cuenta.id_for_label }}">
                                        {{ form.numero_cuenta.label }}
                                        <span class="required-asterisk" aria-label="requerido">*</span>
                                        <span class="tooltip-icon" data-bs-toggle="tooltip" 
                                              title="Número de cuenta de ahorros o corriente">?</span>
                                    </label>
                                    {{ form.numero_cuenta }}
                                    <div class="char-counter" data-max="20" data-field="numero_cuenta">
                                        <span class="current">0</span>/<span class="max">20</span>
                                    </div>
                                    {% if form.numero_cuenta.errors %}
                                        <div class="text-danger" role="alert">{{ form.numero_cuenta.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </fieldset>
                        
                        <hr class="my-4">
                        
                        <!-- SECCIÓN 4: Autorización de Tratamiento de Datos -->
                        <fieldset data-section="4">
                            <div class="section-header">
                                <h5 class="section-title">Autorización de Tratamiento de Datos</h5>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-body">
                                    <div class="consentimiento-box">
                                        <h6 class="fw-bold mb-3">Política de Tratamiento de Datos Personales</h6>
                                        <div class="texto-consentimiento" tabindex="0" role="region" 
                                             aria-label="Texto de política de tratamiento de datos">
                                            <p><strong>Autorizo de manera voluntaria, previa, explícita, informada e inequívoca</strong> 
                                            al SENA para tratar mis datos personales, incluyendo datos financieros, de acuerdo con lo siguiente:</p>
                                            
                                            <p><strong>Finalidad:</strong></p>
                                            <ul>
                                                <li>Gestión administrativa y académica como aprendiz SENA</li>
                                                <li>Consignación de biáticos cuando sea asignado a un semillero de investigación</li>
                                                <li>Comunicaciones relacionadas con actividades del semillero</li>
                                                <li>Cumplimiento de obligaciones legales</li>
                                            </ul>
                                            
                                            <p><strong>Derechos del titular:</strong> Conocer, actualizar, rectificar y solicitar 
                                            la supresión de mis datos personales, así como revocar esta autorización.</p>
                                            
                                            <p><strong>Confidencialidad:</strong> El SENA se compromete a proteger la confidencialidad 
                                            de mis datos bancarios y utilizarlos únicamente para los fines autorizados.</p>
                                            
                                            <p class="mb-0"><small>Para más información sobre el tratamiento de datos personales, 
                                            puede consultar nuestra política completa en la página web del SENA o contactar al 
                                            responsable de protección de datos.</small></p>
                                        </div>
                                    </div>
                                    
                                    <div class="form-check mt-3">
                                        {{ form.acepta_tratamiento_datos }}
                                        <label class="form-check-label fw-bold" for="{{ form.acepta_tratamiento_datos.id_for_label }}">
                                            He leído y acepto la política de tratamiento de datos personales y financieros
                                            <span class="required-asterisk" aria-label="requerido">*</span>
                                        </label>
                                    </div>
                                    {% if form.acepta_tratamiento_datos.errors %}
                                        <div class="text-danger mt-2" role="alert">{{ form.acepta_tratamiento_datos.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </fieldset>
                        
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-success btn-lg" id="submitBtn">
                                <span class="spinner-border spinner-border-sm d-none me-2" role="status" aria-hidden="true"></span>
                                <span class="btn-text">Registrar Aprendiz</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">
                        <i class="bi bi-check-circle-fill me-2"></i>
                        Confirmar Registro
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Por favor, revisa que todos tus datos sean correctos antes de enviar:</p>
                    <div id="summaryContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-pencil-fill me-1"></i> Revisar
                    </button>
                    <button type="button" class="btn btn-success" id="confirmSubmit">
                        <i class="bi bi-check-lg me-1"></i> Confirmar y Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/mensaje.js' %}"></script>
    <script src="{% static 'js/formValidation.js' %}"></script>
    
    <script>
        {% if messages %}
            {% for message in messages %}
                mostrarMensajeExito("{{ message|escapejs }}", "{{ message.tags }}");
            {% endfor %}
        {% endif %}
    </script>
</body>
</html>