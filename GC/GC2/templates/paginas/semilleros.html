{% extends "base.html" %}
{% load static %}

{% block titulo %} Gestión de Semilleros {% endblock %}

{% block css %}
<link href="{% static 'css/semilleros.css' %}" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

{% block contenido %}
{% endblock %}

{% block main %}
   <!-- Mensajes de alerta -->
    {% if messages %}
    <script>
        {% for message in messages %}
            mostrarMensajeExito("{{ message|escapejs }}", "{{ message.tags }}");
        {% endfor %}
    </script>
    {% endif %}


    <div class="contenedor1">
        <div class="contenedor-titulo">
            <img src="{% static 'img/microscopio.png' %}" alt="Semilleros">
            <h1 class="titulo">Semilleros</h1>
        </div>
        
        <form method="GET" class="buscador">

            <!-- Buscador -->
            <div class="input-group">
                <input type="text"
                    class="form-control"
                    name="buscar"
                    placeholder="Buscar semillero..."
                    value="{{ request.GET.buscar }}">
                <button class=" buscar" type="submit">
                    <i class="fa fa-search"></i>
                </button>
            </div>

            <!-- Fechas (lado a lado) -->
            <div class="filtros-fecha">
                <input type="date"
                    class="date"
                    name="fecha_inicio"
                    value="{{ request.GET.fecha_inicio }}">
                <input type="date"
                    class="date"
                    name="fecha_fin"
                    value="{{ request.GET.fecha_fin }}">
            </div>

            <!-- Ordenar -->
            <div class="ordenar">
                <select class="form-select"
                        name="ordenar"
                        onchange="this.form.submit()">
                    <option value="">Ordenar por</option>
                    <option value="recientes">Más recientes</option>
                    <option value="antiguos">Más antiguos</option>
                    <option value="az">A-Z</option>
                    <option value="za">Z-A</option>
                </select>
            </div>

            <!-- Botones -->
            <div class="botones-item">
                <button type="submit" class="aplicar">
                    <i class="fa fa-filter"></i> Aplicar filtros
                </button>
                <button type="button"
                        class="limpiar"
                        onclick="window.location.href='{% url 'semilleros' %}'">
                    <i class="fas fa-sync-alt"></i> Limpiar filtros
                </button>
            </div>

        </form>

        
        <div class="contenedor-semillero">
            <div class="header-semilleros">
                {% if perms.GC2.add_semillero %}
                    <button class="btn crear-semillero" data-bs-toggle="modal" data-bs-target="#modal-crear">
                        <i class="fas fa-plus"></i> Crear Semillero
                    </button>
                {% endif %}
                {% if perms.GC2.delete_semillero %}
                    <a href="#modo-eliminar" class="btn eliminar-semillero">
                        <i class="fa fa-trash-alt"></i> Eliminar Semilleros
                    </a>
                {% endif %}
            </div>
            
            <!-- Formulario para eliminar múltiples semilleros -->
            <form method="POST" action="{% url 'eliminar_semilleros' %}" id="form-eliminar">
                {% csrf_token %}
                
                <!-- Barra de acciones cuando está en modo eliminar -->
                <div class="modo-eliminar-acciones" id="modo-eliminar">
                    <div class="acciones-info">
                        <i class="fas fa-info-circle"></i>
                        <span>Selecciona los semilleros que deseas eliminar</span>
                    </div>
                    <div class="acciones-botones">
                        <a href="{% url 'semilleros' %}" class="btn-cancelar-eliminar">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                        <button type="submit" class="btn-confirmar-eliminar" onclick="return confirm('¿Estás seguro de que deseas eliminar los semilleros seleccionados? Esta acción no se puede deshacer.');">
                            <i class="fas fa-trash"></i> Eliminar Seleccionados
                        </button>
                    </div>
                </div>
                
                <div class="grid-semilleros">
                    {% for semillero in semilleros %}
                    <div class="card-semillero">
                        <!-- Checkbox para seleccionar el semillero -->
                        <input type="checkbox" 
                               name="semilleros_eliminar" 
                               value="{{ semillero.id_sem }}" 
                               id="check-{{ semillero.id_sem }}"
                               class="checkbox-eliminar">
                        <label for="check-{{ semillero.id_sem }}" class="checkbox-label">
                            <i class="fas fa-check"></i>
                        </label>
                        
                        <div class="card-body">
                            <h4>{{ semillero.nombre }}</h4>
                            <h5>{{ semillero.sigla }}</h5>
                            <h6>{{ semillero.cod_sem }}</h6>
                            <p class="card-text">{{ semillero.desc_sem }}</p>
                            <div class="card-info">
                                <span class="badge bg-secondary">
                                    <strong>{{ semillero.total_miembros }}</strong>
                                    <span>Miembros</span>
                                </span>
                                <span class="badge bg-secondary">
                                    <strong>{{ semillero.total_proyectos }}</strong>
                                    <span>Proyectos</span>
                                </span>
                                <span class="badge bg-secondary">
                                    <strong>{{ semillero.total_entregables }}</strong>
                                    <span>Entregables</span>
                                </span>
                            </div>
                            <div class="card-acciones">
                                {% if perms.GC2.change_semillero %}
                                    <a href="{% url 'cambiar_estado_semillero' semillero.id_sem %}"
                                        class="btn-activar {% if semillero.estado == 'desactivado' %}success{% else %}danger{% endif %} btn-cambiar-estado"
                                        data-nombre="{{ semillero.nombre }}"
                                        data-estado="{{ semillero.estado }}"
                                        data-url="{% url 'cambiar_estado_semillero' semillero.id_sem %}">
                                        
                                        {% if semillero.estado == 'desactivado' %}
                                            <i class="fas fa-check-circle"></i>
                                            <span>Activar</span>
                                        {% else %}
                                            <i class="fas fa-ban"></i>
                                            <span>Desactivar</span>
                                        {% endif %}
                                    </a>
                                {% endif %}
                                <a href="{% url 'resumen' semillero.id_sem %}" class="btn btn-primary">Ver más</a>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="no-semilleros">
                        <i class="fas fa-inbox"></i>
                        <p>No hay semilleros disponibles</p>
                    </div>
                    {% endfor %}
                </div>
            </form>
        </div>
    </div>

<!-- MODAL CREAR SEMILLERO -->
<div id="modal-crear" class="modal-overlay">
    <div class="modal-contenedor">
        <!-- Botón cerrar (X) -->
        <a href="{% url 'semilleros' %}" class="modal-cerrar">&times;</a>
        
        <div class="modal-contenido">
            <!-- Header del modal -->
            <div class="modal-header">
                <img src="{% static 'img/microscopio.png' %}" alt="Semilleros">
                <h2 class="modal-titulo">Crear Nuevo Semillero</h2>
            </div>
            
            <!-- Formulario -->
            <form method="POST" action="{% url 'crear_semillero' %}" class="modal-form">
                {% csrf_token %}
                
                <!-- Sección: Información Básica -->
                <div class="modal-seccion">
                    <div class="modal-seccion-titulo">
                        <i class="fas fa-info-circle"></i>
                        <h6>Información Básica</h6>
                    </div>
                    <hr class="modal-hr modal-hr-primario">
                    
                    <div class="modal-form-grid">
                        <div class="modal-campo">
                            <label for="sigla">Siglas *</label>
                            <input type="text" id="subtitulo" name="sigla" placeholder="Ej: Explora la Robótica" required>
                        </div>
                        
                        <div class="modal-campo">
                            <label for="cod_sem">Código *</label>
                            <input type="text" id="codigo" name="cod_sem" placeholder="Ej: SEM-ROB-001" required>
                        </div>
                    </div>
                    
                    <div class="modal-campo" id="sub-campo">
                        <label for="nombre">Nombre del Semillero *</label>
                        <input type="text" id="nombre" name="nombre" placeholder="Ej: Semillero de Robótica" required>
                    </div>
                </div>
                
                <!-- Sección: Descripción y Categorías -->
                <div class="modal-seccion">
                    <div class="modal-seccion-titulo">
                        <i class="fas fa-align-left"></i>
                        <h6>Descripción</h6>
                    </div>
                    <hr class="modal-hr modal-hr-secundario">
                    
                    <div class="modal-campo">
                        <label for="des_sem">Descripción *</label>
                        <textarea id="descripcion" name="desc_sem" placeholder="Describe el propósito del semillero...(max 50)" required></textarea>
                    </div>
                </div>
                
                <!-- Sección: Objetivos -->
                <div class="modal-seccion">
                    <div class="modal-seccion-titulo">
                        <i class="fas fa-bullseye"></i>
                        <h6>Objetivos del Semillero</h6>
                    </div>
                    <hr class="modal-hr modal-hr-terciario">
                    
                    <div id="objetivos-container">
                        <!-- Objetivo 1 (por defecto) -->
                        <div class="objetivo-item">
                            <div class="modal-campo">
                                <label for="objetivo">Objetivo 1 *</label>
                                <div class="objetivo-input-group">
                                    <textarea id="objetivo_1" name="objetivo" class="objetivo-textarea" placeholder="Describe el objetivo del semillero..." required></textarea>
                                    <button type="button" class="btn-eliminar-objetivo" disabled title="Mínimo 1 objetivo">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" id="btn-agregar-objetivo" class="btn-agregar-item">
                        <i class="fas fa-plus-circle"></i> Agregar otro objetivo
                    </button>
                </div>
                
                <hr class="modal-hr modal-hr-final">
                
                <!-- Acciones del modal -->
                <div class="modal-acciones">
                    <a href="{% url 'semilleros' %}" class="modal-btn modal-btn-cancelar">
                        <i class="fas fa-times"></i> Cancelar
                    </a>
                    <button type="submit" class="modal-btn modal-btn-primario">
                        <i class="fas fa-check"></i> Crear Semillero
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="{% static 'js/notificaciones.js' %}"></script>
<script src="{% static 'js/mensaje.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/objetivos.js' %}"></script>

{% endblock %}