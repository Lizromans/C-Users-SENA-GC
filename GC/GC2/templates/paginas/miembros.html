{% extends "base.html" %}
{% load static %}
{% block titulo %} Gesti√≥n de Miembros {% endblock %}
{% block css %}
<link href="{% static 'css/miembros.css' %}" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}
{% block contenido %} {% endblock %}
{% block main %}

    <div class="contenedor-principal">
        <div class="titulo">
            <h3>üë• Miembros</h3>
            <p>Aqu√≠ podr√°s consultar y administrar la informaci√≥n detallada de cada uno de los miembros que hacen parte de los semilleros.</p>
        </div>

        <div class="info">
            <div class="grupo">
                <div class="card amarillo">
                    <div class="icon-cont instructores">
                        <img class="icon" src="{% static 'img/instructor.png' %}" alt="Icono Proyectos">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ total_instructores }}</h5>
                        <p>Instructores</p>           
                    </div>
                </div>
            </div>

            <div class="grupo">
                <div class="card azul">
                    <div class="icon-cont investigadores">
                        <img class="icon" src="{% static 'img/investigador.png' %}" alt="Icono En Desarrollo">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ total_investigadores }}</h5>
                        <p>Investigadores</p>           
                    </div>
                </div>
            </div>

            <div class="grupo">
                <div class="card morado">
                    <div class="icon-cont aprendiz">
                        <img class="icon" src="{% static 'img/Student.png' %}" alt="Icono Completados">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ total_aprendices }}</h5>
                        <p>Aprendices</p>           
                    </div>
                </div>
            </div>
        </div>

        <div class="seccion-busqueda">
        
            <div class="titulo2">
                <h3>Filtrados y Vistas</h3>
                <form method="get" class="pildora-vista">
                    <input type="hidden" name="busqueda" value="{{ busqueda }}">
                    <input type="hidden" name="estado" value="{{ estado_filtro }}">
                    <input type="hidden" name="rol" value="{{ rol_filtro }}">
                    
                    <label>
                        <input type="radio" name="vista" value="tarjeta" onchange="this.form.submit()" {% if request.GET.vista == 'tarjeta' or not request.GET.vista %}checked{% endif %}>
                        <span> <img src="{% static 'img/Layout.png' %}" alt="Tarjetas"> Tarjeta</span>
                    </label>
                    <label>
                        <input type="radio" name="vista" value="lista" onchange="this.form.submit()" {% if request.GET.vista == 'lista' %}checked{% endif %}>
                        <span><img src="{% static 'img/Menu.png' %}" alt="Lista">Lista</span>
                    </label>
                </form>
            </div>
            
            <form method="get" class="busqueda-miembros">
                <input type="hidden" name="vista" value="{{ vista }}">
                <input type="hidden" name="estado" value="{{ estado_filtro }}">
                <input type="hidden" name="rol" value="{{ rol_filtro }}">
                
                <label for="search-miembros">Miembros:</label>
                <div class="input-busqueda">
                    <input 
                        type="text" 
                        id="search-miembros" 
                        name="busqueda"
                        placeholder="Todos los miembros"
                        class="input-miembros"
                        value="{{ busqueda }}"
                    >
                    <button type="submit" class="search-icon">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </form>

            <!-- === FILTRO DE ESTADO (BOTONES) === -->
            <div class="filtros-estado">
                <label>Estado:</label>
                <div class="botones-estado">
                    <a href="?vista={{ vista }}&estado=todos&rol={{ rol_filtro }}&busqueda={{ busqueda }}" 
                    class="btn-estado {% if estado_filtro == 'todos' or not estado_filtro %}activo{% endif %}" 
                    data-estado="todos">Todos</a>

                    <a href="?vista={{ vista }}&estado=Activo&rol={{ rol_filtro }}&busqueda={{ busqueda }}" 
                    class="btn-estado {% if estado_filtro == 'Activo' %}activo{% endif %}" 
                    data-estado="Activo">Activo</a>

                    <a href="?vista={{ vista }}&estado=Inactivo&rol={{ rol_filtro }}&busqueda={{ busqueda }}" 
                    class="btn-estado {% if estado_filtro == 'Inactivo' %}activo{% endif %}" 
                    data-estado="Inactivo">Inactivo</a>
                </div>
            </div>

            <!-- === FILTRO DE ROL (SELECT) === -->
            <div class="filtro-rol">
                <form method="get">
                    <input type="hidden" name="vista" value="{{ vista }}">
                    <input type="hidden" name="estado" value="{{ estado_filtro }}">
                    <input type="hidden" name="busqueda" value="{{ busqueda }}">
                    
                    <label for="rol">Rol:</label>
                    <select name="rol" id="rol" class="filtro" onchange="this.form.submit()">
                        <option value="todos" {% if rol_filtro == 'todos' %}selected{% endif %}>Todos</option>
                        <option value="investigadores" {% if rol_filtro == 'investigadores' %}selected{% endif %}>Investigadores</option>
                        <option value="instructores" {% if rol_filtro == 'instructores' %}selected{% endif %}>Instructores</option>
                        <option value="aprendices" {% if rol_filtro == 'aprendices' %}selected{% endif %}>Aprendices</option>
                        <option value="lider_semillero" {% if rol_filtro == 'lider_semillero' %}selected{% endif %}>L√≠der de Semillero</option>
                        <option value="dinamizador" {% if rol_filtro == 'dinamizador' %}selected{% endif %}>Dinamizador</option>
                        <option value="lider_proyecto" {% if rol_filtro == 'lider_proyecto' %}selected{% endif %}>L√≠der de Proyecto</option>
                    </select>
                </form>
            </div>

            <!-- üîπ Bot√≥n para limpiar -->
            <div class="botones-item">
                <button type="button" class="limpiar" onclick="window.location.href= {% url 'miembros' %}">
                    <i class="fas fa-sync-alt"></i> Limpiar filtros
                </button>
            </div>
        </div>

        
        <!-- Vista de Lista -->
        <div class="lista-container" style="display: {% if request.GET.vista == 'lista' %}block{% else %}none{% endif %};">
            <div class="resumen">
                <div class="header">
                    <h3>Lista de Miembros</h3>
                    <button class="link"data-bs-toggle="modal" data-bs-target="#modalLinkAprendiz">
                        <i class="fa-solid fa-link"></i> 
                        Invitar Aprendiz
                    </button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Correo Electr√≥nico</th>
                            <th>Celular</th>
                            <th>Rol</th>
                            <th>√öltima Sesi√≥n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>

                    <tbody>
                        {% for miembro in miembros %}
                        <tr>
                            <td class="nombre">{{ miembro.nombres }} {{ miembro.apellidos }}</td>
                            <td>{{ miembro.correo_sena }}</td>
                            <td>{{ miembro.celular }}</td>
                            <td>{{ miembro.rol }}</td>
                            <td>{{ miembro.ultima_sesion|default:"No disponible" }}</td>
                            <td>
                                <a href="?miembro_id={{ miembro.id }}&vista={{ vista }}&estado={{ estado_filtro }}&rol={{ rol_filtro }}&busqueda={{ busqueda }}" class="btn">Ver perfil</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6">No hay miembros registrados</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Vista de Tarjetas -->
        <div class="tabla-container" style="display: {% if request.GET.vista == 'lista' %}none{% else %}flex{% endif %};">
            <div class="resumen">
                <div class="titulo-tarjeta">
                    <h3>Lista de Miembros</h3>
                    <button class="link"data-bs-toggle="modal" data-bs-target="#modalLinkAprendiz">
                        <i class="fa-solid fa-link"></i> 
                        Invitar Aprendiz
                    </button>
                </div>
                
                <div class="tarjetas-grid">
                    {% for miembro in miembros %}
                    <div class="grupo">
                        <div class="card {% if miembro.rol == 'Instructor' %}amarillo{% elif miembro.rol == 'Investigador' %}azul{% else %}morado{% endif %}">
                            <div class="icon-cont">
                                <span class="user-icon">
                                    {% if miembro.rol == 'Aprendiz' %}
                                        {% if miembro.imagen_perfil %}
                                            <img src="{{ miembro.imagen_perfil }}" alt="Foto de perfil aprendiz" class="user-perfil">
                                        {% else %}
                                            <img src="{% static 'img/student.png' %}" alt="Foto de perfil aprendiz" class="user-perfil">
                                        {% endif %}
                                    {% else %}
                                        {% if miembro.imagen_perfil %}
                                            <img src="{{ miembro.imagen_perfil }}" alt="Foto de perfil" class="user-perfil">
                                        {% else %}
                                            <img src="{% static 'img/cam.png' %}" alt="Foto de perfil por defecto" class="user-perfil">
                                        {% endif %}
                                    {% endif %}
                                </span>
                            </div>
                            <div class="card-body">
                                <h5 id="nombre">{{ miembro.nombres }} {{ miembro.apellidos }}</h5>
                                <p id="correo">{{ miembro.correo_sena }}</p>
                                <p id="celular">{{ miembro.celular }}</p>
                            </div>
                            <div class="info-badge">
                                <div class="rol {% if miembro.rol == 'Instructor' %}instructores{% elif miembro.rol == 'Investigador' %}investigadores{% else %}aprendices{% endif %}">
                                    <span>{{ miembro.rol }}</span>
                                </div>
                                <div class="ultima-sesion">
                                    <span>{{ miembro.ultima_sesion|default:"" }}</span>
                                </div>
                            </div>
                            <div class="info-icon">
                                <a href="?miembro_id={{ miembro.id }}&vista={{ vista }}&estado={{ estado_filtro }}&rol={{ rol_filtro }}&busqueda={{ busqueda }}">
                                    <i class="fa fa-info-circle" aria-hidden="true"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p>No hay miembros registrados</p>
                    {% endfor %}
                </div>
            </div>
        </div>

    <!-- MODAL DE INFORMACI√ìN DEL MIEMBRO -->
    <div id="modalPerfilMiembro" class="modal-perfil-overlay" 
        {% if miembro_seleccionado %}style="display: flex;"{% endif %}>

        <div class="modal-perfil-contenedor">
            <a class="modal-perfil-cerrar" 
                id="btnCerrarPerfilModal" 
                
                href="?vista={{ vista }}&estado={{ estado_filtro }}&rol={{ rol_filtro }}&busqueda={{ busqueda }}">
                    <i class="fa fa-times"></i>
            </a>

            <div class="perfil-miembro">
                <div class="perfil-miembro-sidebar">
                    <!-- Foto de perfil -->
                    <div class="perfil-foto-contenedor">
                        {% if tipo_miembro == 'usuario' and miembro_seleccionado.imagen_perfil %}
                            <img src="{{ miembro_seleccionado.imagen_perfil.url }}" alt="foto de perfil" id="perfilFotoImg">
                        {% elif tipo_miembro == 'aprendiz' %}
                            <img src="{% static 'img/Student.png' %}" alt="foto de perfil aprendiz" id="perfilFotoImg">
                        {% else %}
                            <img src="{% static 'img/cam.png' %}" alt="foto de perfil" id="perfilFotoImg">
                        {% endif %}
                    </div>

                    <!-- Card de resumen -->
                    <div class="perfil-resumen-card">
                        <h5 class="perfil-resumen-titulo">Resumen</h5>
                        <div class="perfil-resumen-body">
                            <div class="perfil-resumen-fila">
                                <p class="perfil-resumen-label">Estado:</p>
                                <p class="perfil-resumen-valor activo" id="perfilEstado">
                                    {{ miembro_seleccionado.estado|default:"Activo" }}
                                </p>
                            </div>

                            <div class="perfil-resumen-fila">
                                <p class="perfil-resumen-label">Semilleros:</p>
                                <p class="perfil-resumen-numero" id="perfilSemilleros">
                                    {{ miembro_seleccionado.semilleros.count|default:"0" }}
                                </p>
                            </div>

                            <div class="perfil-resumen-fila">
                                <p class="perfil-resumen-label">Proyectos:</p>
                                <p class="perfil-resumen-numero" id="perfilProyectos">
                                    {{ miembro_seleccionado.proyectos.count|default:"0" }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CONTENEDOR PRINCIPAL DEL PERFIL -->
                <div class="perfil-informacion-contenedor">
                    <form method="post" action="">
                        {% csrf_token %}

                        <!-- INFORMACI√ìN PERSONAL -->
                        <div class="perfil-seccion">
                            <div class="perfil-seccion-titulo">
                                <img src="{% static 'img/User.png' %}" alt="Informaci√≥n Personal">
                                <h6>Informaci√≥n Personal</h6>
                            </div>
                            <hr class="perfil-hr-personal">
                            <div class="perfil-info-grid">
                                <div class="perfil-campo">
                                    <label for="perfilNombres">Nombres:</label>
                                    <input type="text" id="perfilNombres" name="nombres"
                                        value="{{ miembro_seleccionado.nombres }}"readonly>
                                </div>
                                <div class="perfil-campo">
                                    <label for="perfilApellidos">Apellidos:</label>
                                    <input type="text" id="perfilApellidos" name="apellidos"
                                        value="{{ miembro_seleccionado.apellidos }}" readonly>
                                </div>
                                <div class="perfil-campo">
                                    <label for="perfilCedula">C√©dula:</label>
                                    <input type="text" id="perfilCedula" name="cedula"
                                        value="{{ miembro_seleccionado.cedula }}"readonly>
                                </div>
                                <div class="perfil-campo">
                                    <label for="perfilCorreoPersonal">Correo Personal:</label>
                                    <input type="email" id="perfilCorreoPersonal" name="correo_personal"
                                        value="{{ miembro_seleccionado.correo_personal|default_if_none:'' }}" readonly>
                                </div>
                                <div class="perfil-campo">
                                    <label for="perfilCelular">Celular:</label>
                                    <input type="tel" id="perfilCelular" name="celular"
                                        value="{{ miembro_seleccionado.celular|default_if_none:'' }}" readonly>
                                </div>

                                <div class="perfil-campo">
                                    <label for="perfilFechaNacimiento">Fecha de Nacimiento:</label>
                                    <input type="text" id="perfilFechaNacimiento" name="fecha_nacimiento"
                                        value="{{ miembro_seleccionado.fecha_nacimiento|default_if_none:'' }}" readonly>
                                </div>
                                <div class="perfil-campo">
                                    <label for="perfilEstado">Estado:</label>
                                    <select name="estado" id="perfilEstado" class="perfil-select">
                                        <option value="Activo" {% if miembro_seleccionado.estado == "Activo" %}selected{% endif %}>Activo</option>
                                        <option value="Inactivo" {% if miembro_seleccionado.estado == "Inactivo" %}selected{% endif %}>Inactivo</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- INFORMACI√ìN PROFESIONAL (solo para usuarios) -->
                        {% if tipo_miembro == 'usuario' %}
                        <div class="perfil-seccion">
                            <div class="perfil-seccion-titulo">
                                <img src="{% static 'img/briefcase.png' %}" alt="Informaci√≥n Profesional">
                                <h6>Informaci√≥n Profesional</h6>
                            </div>
                            <hr class="perfil-hr-profesional">
                            <div class="perfil-info-grid">
                                <div class="perfil-campo">
                                    <label for="perfilCorreoSena">Correo Sena:</label>
                                    <input type="email" id="perfilCorreoSena" name="correo_sena"
                                        value="{{ miembro_seleccionado.correo_sena }}"  readonly>
                                </div>
                                <div class="perfil-campo">
                                    <label for="perfilVinculacion">Vinculaci√≥n laboral:</label>
                                    <input type="text" id="perfilVinculacion" name="vinculacion"
                                        value="{{ miembro_seleccionado.vinculacion|default_if_none:'' }}" readonly>
                                </div>
                                <div class="perfil-campo">
                                    <label for="perfilDependencia">Dependencia/√Årea:</label>
                                    <input type="text" id="perfilDependencia" name="dependencia"
                                        value="{{ miembro_seleccionado.dependencia|default_if_none:'' }}" readonly>
                                </div>
                                <div class="perfil-campo">
                                    <label for="perfilRol">Rol:</label>
                                    <input type="text" id="perfilRol" name="rol"
                                        value="{{ miembro_seleccionado.rol }}" readonly>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- INFORMACI√ìN ACAD√âMICA (solo para aprendices) -->
                        {% if tipo_miembro == 'aprendiz' %}
                        <div class="perfil-seccion">
                            <div class="perfil-seccion-titulo">
                                <img src="{% static 'img/student.png' %}" alt="Informaci√≥n Acad√©mica">
                                <h6>Informaci√≥n Acad√©mica</h6>
                            </div>
                            <hr class="perfil-hr-academica">

                            <div class="perfil-info-grid">
                                <div class="perfil-campo">
                                    <label for="perfilCorreoSena">Correo SENA:</label>
                                    <input type="email" id="perfilCorreoSena" name="correo_sena"
                                        value="{{ miembro_seleccionado.correo_sena }}" readonly>
                                </div>

                                <div class="perfil-campo">
                                    <label for="perfilFicha">Ficha:</label>
                                    <input type="text" id="perfilFicha" name="ficha"
                                        value="{{ miembro_seleccionado.ficha }}" readonly>
                                </div>

                                <div class="perfil-campo">
                                    <label for="perfilPrograma">Programa:</label>
                                    <input type="text" id="perfilPrograma" name="programa"
                                        value="{{ miembro_seleccionado.programa }}" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="perfil-seccion">
                            <div class="perfil-seccion-titulo">
                                <img src="{% static 'img/banco.png' %}" alt="Informaci√≥n Bancaria">
                                <h6>Informaci√≥n Bancaria</h6>
                            </div>
                            <hr class="perfil-hr-academica">

                            <div class="perfil-info-grid">
                                <div class="perfil-campo">
                                    <label for="perfilMedioBancario">Medio Bancario:</label>
                                    <input type="text" id="perfilMedioBancario" name="medio_bancario"
                                        value="{{ miembro_seleccionado.medio_bancario }}" readonly>
                                </div>

                                <div class="perfil-campo">
                                    <label for="perfilCuenta">N√∫mero de Cuenta:</label>
                                    <div class="input-con-icono">
                                        <input type="text" id="perfilCuenta" name="numero_cuenta"
                                            value="{{ miembro_seleccionado.numero_cuenta_visible }}" readonly>
                                        
                                        {% if miembro_seleccionado.numero_cuenta_visible|length > 11 %}
                                            <!-- Si el n√∫mero est√° revelado, mostrar bot√≥n para ocultar -->
                                            <a href="{% url 'limpiar_numero_revelado' %}" 
                                                class="icono-interno" 
                                                title="Ocultar n√∫mero">
                                                <i class="fa fa-eye-slash"></i>
                                            </a>
                                        {% else %}
                                            <!-- Si est√° oculto, mostrar bot√≥n para ver -->
                                            <a href="{% url 'solicitar_codigo_verificacion_form' miembro_seleccionado.cedula %}" 
                                                class="icono-interno" 
                                                title="Ver n√∫mero completo">
                                                <i class="fa fa-eye"></i>
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- INFORMACI√ìN DE SEMILLEROS -->
                        <div class="perfil-seccion">
                            <div class="perfil-seccion-titulo">
                                <img src="{% static 'img/microscopio.png' %}" alt="Informaci√≥n de Semilleros">
                                <h6>Informaci√≥n de Semilleros</h6>
                            </div>
                            <hr class="perfil-hr-semilleros">
                            <div class="perfil-info-grid">
                                {% for semillero in miembro_seleccionado.semilleros %}
                                    <div class="perfil-campo">
                                        <input type="text" class="perfil-input-readonly" readonly
                                            value="{{ semillero.sigla }} - {{ semillero.nombre }}">
                                    </div>
                                {% empty %}
                                    <p class="perfil-sin-datos">No est√° asociado a ning√∫n semillero.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- INFORMACI√ìN DE PROYECTOS -->
                        <div class="perfil-seccion">
                            <div class="perfil-seccion-titulo">
                                <img src="{% static 'img/project.png' %}" alt="Informaci√≥n de Proyectos">
                                <h6>Informaci√≥n de Proyectos</h6>
                            </div>
                            <hr class="perfil-hr-proyectos">
                            <div class="perfil-info-grid">
                                {% for proyecto in miembro_seleccionado.proyectos %}
                                    <div class="perfil-campo">
                                        <input type="text" class="perfil-input-readonly" readonly
                                            value="{{ proyecto.nom_pro }}">
                                    </div>
                                {% empty %}
                                    <p class="perfil-sin-datos">No est√° asociado a ning√∫n proyecto.</p>
                                {% endfor %}
                            </div>
                        </div>

                        <hr class="perfil-hr-final">
                        <button type="submit" class="perfil-btn-guardar">Guardar Cambios</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

<div class="modal fade" id="modalLinkAprendiz" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fa-solid fa-share-nodes"></i> 
                    Enlace de Registro
                </h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <p class="mb-2">Comparte este enlace para que el aprendiz realice su registro:</p>

                <!-- INPUT + BOT√ìN COPIAR -->
                <div class="input-group">
                    <input type="text" id="linkRegistroApre" 
                           class="form-control" readonly
                           value="https://{{ request.get_host }}{% url 'registro_aprendiz' %}">

                    <button class="btn btn-success" type="button"
                            onclick="navigator.clipboard.writeText(document.getElementById('linkRegistroApre').value)">
                        <i class="fa fa-copy"></i>
                    </button>
                </div>

                <p class="text-muted text-center mt-2">Haz clic en el icono para copiar el enlace</p>

            </div>

        </div>
    </div>
</div>


<!-- Modal de Verificaci√≥n de C√≥digo -->
<div id="modalVerificacionCodigo" class="modal-verificacion-overlay" 
     {% if mostrar_modal_codigo %}style="display: flex;"{% endif %}>
    <div class="modal-verificacion-contenedor">
        <!-- ‚úÖ Cerrar sin par√°metro miembro_id si no hay seleccionado -->
        <a href="{% if aprendiz_verificacion %}?miembro_id={{ aprendiz_verificacion.cedula_apre }}&vista={{ vista }}&estado={{ estado_filtro }}&rol={{ rol_filtro }}&busqueda={{ busqueda }}{% else %}?vista={{ vista }}&estado={{ estado_filtro }}&rol={{ rol_filtro }}&busqueda={{ busqueda }}{% endif %}" 
           class="modal-verificacion-cerrar"
           onclick="{% if aprendiz_verificacion %}cancelarVerificacion('{{ aprendiz_verificacion.cedula_apre }}'){% else %}cancelarVerificacion(){% endif %}">
            <i class="fa fa-times"></i>
        </a>
        
        <div class="modal-verificacion-contenido">
            <div class="modal-verificacion-icono">
                <i class="fa fa-lock"></i>
            </div>
            
            <h3 class="modal-verificacion-titulo">Verificaci√≥n de Seguridad</h3>
            <p class="modal-verificacion-texto">
                Ingresa el c√≥digo de 6 d√≠gitos enviado a tu correo electr√≥nico
            </p>
            
            <form method="post" action="">
                {% csrf_token %}
                {% if aprendiz_verificacion %}
                <input type="hidden" name="miembro_id" value="{{ aprendiz_verificacion.cedula_apre }}">
                {% endif %}
                <input type="hidden" name="vista" value="{{ vista }}">
                <input type="hidden" name="estado" value="{{ estado_filtro }}">
                <input type="hidden" name="rol" value="{{ rol_filtro }}">
                <input type="hidden" name="busqueda" value="{{ busqueda }}">
                
                <div class="codigo-inputs">
                    <input type="text" name="codigo" maxlength="6" 
                           class="codigo-input-completo" 
                           placeholder="000000"
                           pattern="[0-9]{6}"
                           required
                           autofocus />
                </div>
                
                <button type="submit" class="btn-verificar-codigo">
                    <i class="fa fa-check-circle"></i>
                    Verificar C√≥digo
                </button>
            </form>
            
        </div>
    </div>
</div>

<script>
function cancelarVerificacion(aprendizId) {
    // Limpiar variables de sesi√≥n mediante AJAX
    fetch("{% url 'cancelar_verificacion' %}", {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        }
    }).then(() => {
        // Redirigir despu√©s de limpiar
        if (aprendizId) {
            window.location.href = `?miembro_id=${aprendizId}&vista={{ vista }}&estado={{ estado_filtro }}&rol={{ rol_filtro }}&busqueda={{ busqueda }}`;
        } else {
            window.location.href = `?vista={{ vista }}&estado={{ estado_filtro }}&rol={{ rol_filtro }}&busqueda={{ busqueda }}`;
        }
    });
}
</script>


    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/mensaje.js' %}"></script>
{% endblock %}