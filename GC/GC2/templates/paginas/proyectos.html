{% extends "base.html" %}
{% load static %}
{% block titulo %} Gesti贸n de Proyectos {% endblock %}
{% block css %}
<link href="{% static 'css/proyectos.css' %}" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}
{% block contenido %} {% endblock %}
{% block main %}

    <div class="contenedor-principal">
        <div class="titulo">
            <h3> Proyectos</h3>
            <p>Gestiona y monitorea todos los proyectos de tus semilleros desde un solo lugar</p>
        </div>
        <div class="info">
            <div class="grupo">
                <div class="card naranja">
                    <div class="icon-cont proyectos">
                        <img class="icon" src="{% static 'img/project.png' %}" alt="Icono Proyectos">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ total_proyectos }}</h5>
                        <p>Total Proyectos</p>           
                    </div>
                    <div class="info-badge naranja">
                        <span>+{{ proyectos_mes }} este mes</span>
                    </div>
                </div>
            </div>

            <div class="grupo">
                <div class="card verde">
                    <div class="icon-cont completados">
                        <img class="icon" src="{% static 'img/Verified.png' %}" alt="Icono Completados">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ proyectos_completados }}</h5>
                        <p>Proyectos completados</p>           
                    </div>
                    <div class="info-badge verde">
                        <span>+{{ completados_mes }} este mes</span>
                    </div>
                </div>
            </div>

            <div class="grupo">
                <div class="card rojo">
                    <div class="icon-cont pendientes">
                        <img class="icon" src="{% static 'img/Hourglass.png' %}" alt="Icono Pendientes">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ proyectos_pendientes }}</h5>
                        <p>Proyectos pendientes</p>           
                    </div>
                    <div class="info-badge rojo">
                        <span>+{{ pendientes_mes }} este mes</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="busqueda">
            <h3>B煤squeda y Filtrados</h3>
            <form method="GET" action="">
                <div class="filtros">
                    <div class="search-container">
                        <input type="text" name="buscar" placeholder="Buscar proyecto..." class="buscador" value="{{ request.GET.buscar }}">
                        <button type="submit" class="search-icon">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <select name="estado" class="filtro" onchange="this.form.submit()">
                        <option value="">Todos los estados</option>
                        <option value="pendiente" {% if request.GET.estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
                        <option value="diagnostico" {% if request.GET.estado == 'diagnostico' %}selected{% endif %}>En diagn贸stico</option>
                        <option value="planeacion" {% if request.GET.estado == 'planeacion' %}selected{% endif %}>En planeaci贸n</option>
                        <option value="ejecucion" {% if request.GET.estado == 'ejecucion' %}selected{% endif %}>En ejecuci贸n</option>
                        <option value="completado" {% if request.GET.estado == 'completado' %}selected{% endif %}>Completado</option>
                    </select>

                    <select name="tipo" class="filtro" onchange="this.form.submit()">
                        <option value="">Todos los tipos</option>
                        <option value="sennova" {% if request.GET.tipo == "sennova" %}selected{% endif %}>Sennova</option>
                        <option value="capacidad instalada" {% if request.GET.tipo == "capacidad instalada" %}selected{% endif %}>Capacidad Instalada</option>
                        <option value="formativa" {% if request.GET.tipo == "formativa" %}selected{% endif %}>Formativa</option>
                    </select>
                    <select name="orden" class="filtro" onchange="this.form.submit()">
                        <option value="">Ordenar por</option>
                        <option value="fecha_creacion" {% if request.GET.orden == 'fecha_creacion' %}selected{% endif %}>Fecha de creaci贸n</option>
                        <option value="nombre" {% if request.GET.orden == 'nombre' %}selected{% endif %}>Nombre</option>
                    </select>
                    <div class="botones-item">
                        <button type="button" class="limpiar" onclick="window.location.href= {% url 'proyectos' %}">
                            <i class="fas fa-sync-alt"></i> Limpiar filtros
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <div class="resumen">
            <div class="tabla-container">
                <h3>Lista de Proyectos</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Nombre del Proyecto</th>
                            <th>Semillero</th>
                            <th>Tipo</th>
                            <th>Estado</th>
                            <th>Progreso</th>
                            <th>Fecha creaci贸n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>

                    <tbody>
                        {% for proyecto in proyectos %}
                        <tr>
                            <td class="nombre">{{ proyecto.nom_pro }}</td>
                            <td>
                                {% for semillero in proyecto.semilleros.all %}
                                    {{ semillero.nombre }}{% if not forloop.last %}, {% endif %}
                                {% empty %}
                                    Sin semillero
                                {% endfor %}
                            </td>
                            <td>
                                {% if proyecto.tipo == "capacidadinstalada" %}
                                    Capacidad Instalada
                                {% elif proyecto.tipo == "formativo" %}
                                    Formativo
                                {% elif proyecto.tipo == "sennova" %}
                                    Sennova
                                {% else %}
                                    {{ proyecto.tipo|capfirst }}
                                {% endif %}
                            </td>
                            <td class="estado">
                                {% if proyecto.estado_pro == 'pendiente' %}
                                    <span class="estado pendiente">Pendiente</span>
                                {% elif proyecto.estado_pro == 'diagnostico' %}
                                    <span class="estado diagnostico">En diagn贸stico</span>
                                {% elif proyecto.estado_pro == 'planeacion' %}
                                    <span class="estado planeacion">Planeaci贸n</span>
                                {% elif proyecto.estado_pro == 'ejecucion' %}
                                    <span class="estado ejecucion">En ejecuci贸n</span>
                                {% elif proyecto.estado_pro == 'completado' %}
                                    <span class="estado completado">Completado</span>
                                {% else %}
                                    <span class="estado desconocido">Sin estado</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="progress-bar">
                                    <div class="progress-fill" 
                                        role="progressbar"
                                        style="width: {{ proyecto.progreso }}%"
                                        aria-valuenow="{{ proyecto.progreso }}" 
                                        aria-valuemin="0" 
                                        aria-valuemax="100"> {{ proyecto.progreso }}%
                                    </div>
                                </div>
                            </td>
                            <td>{{ proyecto.fecha_creacion|date:"d/m/Y" }}</td>
                            <td>
                                <a href="{% url 'detalle-proyecto' proyecto.semilleros.first.id_sem proyecto.cod_pro %}" class="btn">Ver</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" class="text-center">No hay proyectos disponibles</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="{% static 'js/bootstrap.min.js' %}"></script>
{% endblock %}