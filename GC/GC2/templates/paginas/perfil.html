{% extends "base.html" %}
{% load static %}
{% block titulo %} Perfil {% endblock %}
{% block css %}
<link href="{% static 'css/perfil.css' %}" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}
{% block contenido %} {% endblock %}
{% block main %}

<!-- Mensajes de alerta -->
{% if messages %}
<script>
    {% for message in messages %}
        mostrarMensajeExito("{{ message|escapejs }}", "{{ message.tags }}");
    {% endfor %}
</script>
{% endif %}

<form method="POST" action="{% url 'perfil' %}">
    {% csrf_token %}
    <div class="perfil">
        
        <!-- ========== SECCI√ìN SUPERIOR ========== -->
        <div class="top-section">
            
            <!-- Tarjeta de Perfil con Foto -->
            <div class="cont-1">
                <div class="foto-container">
                    <div class="foto">
                        <form action="{% url 'actualizar_foto' %}" method="POST" enctype="multipart/form-data" style="width: 100%; height: 100%;">
                            {% csrf_token %}
                            
                            {% if usuario.imagen_perfil %}
                                <img src="{{ usuario.imagen_perfil.url }}" alt="Foto de perfil" class="foto-perfil">
                            {% else %}
                                <img src="{% static 'img/cam.png' %}" alt="foto de perfil">
                            {% endif %}

                            <label for="foto-input" class="icon-edit">
                                <img src="{% static 'img/edit.png' %}" alt="Editar foto">
                            </label>
                            <input type="file" name="imagen_perfil" id="foto-input" accept="image/*" onchange="this.form.submit()" hidden>
                        </form>
                    </div>
                </div>

                <div class="perfil-info">
                    <h2 class="perfil-nombre">{{ usuario.nom_usu }} {{ usuario.ape_usu }}</h2>
                    <p class="perfil-rol">{{ usuario.rol }}</p>
                    <div class="estado-badge">
                        <span class="estado-dot"></span>
                        {{ usuario.estado }}
                    </div>
                    <div class="perfil-stats">
                        <div class="stat-item">
                            <div class="stat-icon">üå±</div>
                            <div class="stat-content">
                                <span class="stat-value">{{ total_semilleros }}</span>
                                <span class="stat-label">Semilleros</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-content">
                                <span class="stat-value">{{ total_proyectos }}</span>
                                <span class="stat-label">Proyectos</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tarjeta de √öltima Sesi√≥n -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">‚è∞</div>
                    <h3 class="card-title">√öltima Sesi√≥n</h3>
                </div>
                <div class="session-time">
                    {% if usuario.last_login %}
                        {{ ultimo_acceso }}
                    {% else %}
                        Nunca
                    {% endif %}
                </div>
                <div class="card-details">
                    <div class="card-detail">
                        <div class="detail-label">Departamento</div>
                        <div class="detail-value">{{ usuario.dependencia|default:"N/A" }}</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Contrato</div>
                        <div class="detail-value">{{ usuario.vinculacion_laboral|default:"N/A" }}</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Email</div>
                        <div class="detail-value">{{ usuario.correo_ins|truncatechars:15 }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== SECCI√ìN INFERIOR - DOS COLUMNAS ========== -->
        <div class="bottom-section">
            
            <!-- COLUMNA IZQUIERDA -->
            <div class="columna">
                
                <!-- Informaci√≥n Personal -->
                <div class="seccion scrollable">
                    <div class="titulo">
                        <img src="{% static 'img/User.png' %}" alt="Informaci√≥n Personal">
                        <h6>Informaci√≥n Personal</h6>
                    </div>
                    <hr>
                    <div class="info-group">
                        <div class="info">
                            <label for="nombre1">Nombres:</label>
                            <input type="text" id="nombre1" name="nombre1" value="{{ usuario.nom_usu }}">
                        </div>
                        <div class="info">
                            <label for="nombre2">Apellidos:</label>
                            <input type="text" id="nombre2" name="nombre2" value="{{ usuario.ape_usu }}">
                        </div>
                        <div class="info">
                            <label for="cedula">C√©dula:</label>
                            <input type="num" id="cedula" name="cedula" value="{{ usuario.cedula }}" readonly>
                        </div>
                        <div class="info">
                            <label for="correo1">Correo Personal:</label>
                            <input type="text" id="correo1" name="correo1" value="{{ usuario.correo_per|default_if_none:"" }}" placeholder="Ingrese su correo personal">
                        </div>
                        <div class="info">
                            <label for="celular">Celular:</label>
                            <input type="num" id="celular" name="celular" value="{{ usuario.telefono|default_if_none:"" }}" placeholder="Ingrese su n√∫mero de celular">
                        </div>
                        <div class="info">
                            <label for="fecha">Fecha de Nacimiento:</label>
                            <input type="date" id="fecha" name="fecha" value="{% if usuario.fecha_nacimiento %}{{ usuario.fecha_nacimiento|date:'Y-m-d' }}{% endif %}" placeholder="Ingrese su fecha de nacimiento">
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n de Semilleros -->
                <div class="seccion">
                    <div class="titulo">
                        <img src="{% static 'img/microscopio.png' %}" alt="Informaci√≥n de Semilleros">
                        <h6>Semilleros</h6>
                    </div>
                    <hr>
                    <div class="info-group2">
                        {% for semillero in semilleros %}
                        <a href="{% url 'resumen' semillero.id_sem %}" class="input-fake">
                            {{ semillero.sigla }}
                        </a>
                        {% empty %}
                        <p style="grid-column: 1 / -1; text-align: center; color: var(--color-text-secondary);">
                            No est√°s asociado a ning√∫n semillero.
                        </p>
                        {% endfor %}
                    </div>
                </div>

            </div>

            <!-- COLUMNA DERECHA -->
            <div class="columna">
                
                <!-- Informaci√≥n Profesional -->
                <div class="seccion scrollable">
                    <div class="titulo">
                        <img src="{% static 'img/briefcase.png' %}" alt="Informaci√≥n Profesional">
                        <h6>Informaci√≥n Profesional</h6>
                    </div>
                    <hr>
                    <div class="info-group">
                        <div class="info">
                            <label for="correo2">Correo Sena:</label>
                            <input type="text" id="correo2" name="correo2" value="{{ usuario.correo_ins }}">
                        </div>
                        <div class="info">
                            <label for="vinculacion">Vinculaci√≥n laboral:</label>
                            <select id="vinculacion" name="vinculacion" required>
                                <option value="" disabled selected>Selecciona tu rol</option>
                                <option value="Contratista" {% if usuario.vinculacion_laboral == "Contratista" %}selected{% endif %}>Contratista</option>
                                <option value="Planta" {% if usuario.vinculacion_laboral == "Planta" %}selected{% endif %}>Planta</option>
                            </select>
                        </div>
                        <div class="info">
                            <label for="dependencia">Dependencia/√Årea:</label>
                            <input type="text" id="dependencia" name="dependencia" value="{{ usuario.dependencia|default_if_none:"" }}" placeholder="Ingrese su dependencia/√°rea">
                        </div>
                        <div class="info">
                            <label for="rol">Rol:</label>
                            <input type="text" id="rol" name="rol" value="{{ usuario.rol }}">
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n de Proyectos -->
                <div class="seccion">
                    <div class="titulo">
                        <img src="{% static 'img/project.png' %}" alt="Informaci√≥n de Proyectos">
                        <h6>Proyectos</h6>
                    </div>
                    <hr>
                    <div class="info-group2">
                        {% for proyecto in proyectos %}
                        <a href="{% url 'detalle-proyecto' proyecto.id_sem.id_sem proyecto.cod_pro.cod_pro %}"
                           class="textarea-fake">
                            {{ proyecto.cod_pro.nom_pro }}
                        </a>
                        {% empty %}
                        <p style="grid-column: 1 / -1; text-align: center; color: var(--color-text-secondary);">
                            No est√°s asociado a ning√∫n proyecto.
                        </p>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>

        <!-- Bot√≥n Guardar - Solo visible cuando hay cambios -->
        <div class="guardar-container visible">
            <button type="submit" class="guardar">Guardar Cambios</button>
        </div>

    </div>
</form>

<script src="{% static 'js/notificaciones.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/mensaje.js' %}"></script>

{% endblock %}